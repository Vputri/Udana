{"ast":null,"code":"var _jsxFileName = \"/home/vika/Documents/blog-strapi/frontend/src/queries/article/articles.js\",\n    _s = $RefreshSig$();\n\nimport { useHistory } from 'react-router';\nimport { gql, useQuery } from '@apollo/client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst LINKS_PER_PAGE = 5;\nconst ARTICLES_QUERY = gql`\n  query Articles(\n    $take: Int\n    $skip: Int\n    $orderBy: LinkOrderByInput){\n    articles(take: $take, skip: $skip, orderBy: $orderBy){\n      slug\n      title\n      content\n      description\n      author{\n        name\n      }\n      category {\n        slug\n        name\n      }\n      image {\n        url\n      }\n    }\n  }\n`;\n\nconst getLinksToRender = (isNewPage, data) => {\n  if (isNewPage) {\n    return data.feed.links;\n  }\n\n  const rankedLinks = data.feed.links.slice();\n  rankedLinks.sort((l1, l2) => l2.votes.length - l1.votes.length);\n  return rankedLinks;\n};\n\nconst getQueryVariables = (isNewPage, page) => {\n  const skip = isNewPage ? (page - 1) * LINKS_PER_PAGE : 0;\n  const take = isNewPage ? LINKS_PER_PAGE : 100;\n  const orderBy = {\n    createdAt: 'desc'\n  };\n  return {\n    take,\n    skip,\n    orderBy\n  };\n};\n\nconst LinkList = () => {\n  _s();\n\n  const history = useHistory();\n  const isNewPage = history.location.pathname.includes('new');\n  const pageIndexParams = history.location.pathname.split('/');\n  const page = parseInt(pageIndexParams[pageIndexParams.length - 1]);\n  const pageIndex = page ? (page - 1) * LINKS_PER_PAGE : 0;\n  const {\n    data,\n    loading,\n    error,\n    subscribeToMore\n  } = useQuery(FEED_QUERY, {\n    variables: getQueryVariables(isNewPage, page)\n  });\n  subscribeToMore({\n    document: NEW_LINKS_SUBSCRIPTION,\n    updateQuery: (prev, {\n      subscriptionData\n    }) => {\n      if (!subscriptionData.data) return prev;\n      const newLink = subscriptionData.data.newLink;\n      const exists = prev.feed.links.find(({\n        id\n      }) => id === newLink.id);\n      if (exists) return prev;\n      return Object.assign({}, prev, {\n        feed: {\n          links: [newLink, ...prev.feed.links],\n          count: prev.feed.links.length + 1,\n          __typename: prev.feed.__typename\n        }\n      });\n    }\n  });\n  subscribeToMore({\n    document: NEW_VOTES_SUBSCRIPTION\n  });\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [loading && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 19\n    }, this), error && /*#__PURE__*/_jsxDEV(\"pre\", {\n      children: JSON.stringify(error, null, 2)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 17\n    }, this), data && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [getLinksToRender(isNewPage, data).map((link, index) => /*#__PURE__*/_jsxDEV(Link, {\n        link: link,\n        index: index + pageIndex\n      }, link.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 15\n      }, this)), isNewPage && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex ml4 mv3 gray\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pointer mr2\",\n          onClick: () => {\n            if (page > 1) {\n              history.push(`/new/${page - 1}`);\n            }\n          },\n          children: \"Previous\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pointer\",\n          onClick: () => {\n            if (page <= data.feed.count / LINKS_PER_PAGE) {\n              const nextPage = page + 1;\n              history.push(`/new/${nextPage}`);\n            }\n          },\n          children: \"Next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true);\n};\n\n_s(LinkList, \"uZ+VzZ/K/WIzLe4+uXI1/G8CEvs=\", false, function () {\n  return [useHistory, useQuery];\n});\n\n_c = LinkList;\nexport default ARTICLES_QUERY;\n\nvar _c;\n\n$RefreshReg$(_c, \"LinkList\");","map":{"version":3,"sources":["/home/vika/Documents/blog-strapi/frontend/src/queries/article/articles.js"],"names":["useHistory","gql","useQuery","LINKS_PER_PAGE","ARTICLES_QUERY","getLinksToRender","isNewPage","data","feed","links","rankedLinks","slice","sort","l1","l2","votes","length","getQueryVariables","page","skip","take","orderBy","createdAt","LinkList","history","location","pathname","includes","pageIndexParams","split","parseInt","pageIndex","loading","error","subscribeToMore","FEED_QUERY","variables","document","NEW_LINKS_SUBSCRIPTION","updateQuery","prev","subscriptionData","newLink","exists","find","id","Object","assign","count","__typename","NEW_VOTES_SUBSCRIPTION","JSON","stringify","map","link","index","push","nextPage"],"mappings":"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","sourcesContent":["import { useHistory } from 'react-router';\nimport { gql, useQuery } from '@apollo/client';\n\nconst LINKS_PER_PAGE = 5;\nconst ARTICLES_QUERY = gql`\n  query Articles(\n    $take: Int\n    $skip: Int\n    $orderBy: LinkOrderByInput){\n    articles(take: $take, skip: $skip, orderBy: $orderBy){\n      slug\n      title\n      content\n      description\n      author{\n        name\n      }\n      category {\n        slug\n        name\n      }\n      image {\n        url\n      }\n    }\n  }\n`;\n\nconst getLinksToRender = (isNewPage, data) => {\n  if (isNewPage) {\n    return data.feed.links;\n  }\n  const rankedLinks = data.feed.links.slice();\n  rankedLinks.sort(\n    (l1, l2) => l2.votes.length - l1.votes.length\n  );\n  return rankedLinks;\n};\n\nconst getQueryVariables = (isNewPage, page) => {\n  const skip = isNewPage ? (page - 1) * LINKS_PER_PAGE : 0;\n  const take = isNewPage ? LINKS_PER_PAGE : 100;\n  const orderBy = { createdAt: 'desc' };\n  return { take, skip, orderBy };\n};\n\nconst LinkList = () => {\n  const history = useHistory();\n  const isNewPage = history.location.pathname.includes(\n    'new'\n  );\n  const pageIndexParams = history.location.pathname.split(\n    '/'\n  );\n  const page = parseInt(\n    pageIndexParams[pageIndexParams.length - 1]\n  );\n\n  const pageIndex = page ? (page - 1) * LINKS_PER_PAGE : 0;\n\n  const {\n    data,\n    loading,\n    error,\n    subscribeToMore\n  } = useQuery(FEED_QUERY, {\n    variables: getQueryVariables(isNewPage, page)\n  });\n\n  subscribeToMore({\n    document: NEW_LINKS_SUBSCRIPTION,\n    updateQuery: (prev, { subscriptionData }) => {\n      if (!subscriptionData.data) return prev;\n      const newLink = subscriptionData.data.newLink;\n      const exists = prev.feed.links.find(\n        ({ id }) => id === newLink.id\n      );\n      if (exists) return prev;\n\n      return Object.assign({}, prev, {\n        feed: {\n          links: [newLink, ...prev.feed.links],\n          count: prev.feed.links.length + 1,\n          __typename: prev.feed.__typename\n        }\n      });\n    }\n  });\n\n  subscribeToMore({\n    document: NEW_VOTES_SUBSCRIPTION\n  });\n\n  return (\n    <>\n      {loading && <p>Loading...</p>}\n      {error && <pre>{JSON.stringify(error, null, 2)}</pre>}\n      {data && (\n        <>\n          {getLinksToRender(isNewPage, data).map(\n            (link, index) => (\n              <Link\n                key={link.id}\n                link={link}\n                index={index + pageIndex}\n              />\n            )\n          )}\n          {isNewPage && (\n            <div className=\"flex ml4 mv3 gray\">\n              <div\n                className=\"pointer mr2\"\n                onClick={() => {\n                  if (page > 1) {\n                    history.push(`/new/${page - 1}`);\n                  }\n                }}\n              >\n                Previous\n              </div>\n              <div\n                className=\"pointer\"\n                onClick={() => {\n                  if (\n                    page <=\n                    data.feed.count / LINKS_PER_PAGE\n                  ) {\n                    const nextPage = page + 1;\n                    history.push(`/new/${nextPage}`);\n                  }\n                }}\n              >\n                Next\n              </div>\n            </div>\n          )}\n        </>\n      )}\n    </>\n  );\n};\n\nexport default ARTICLES_QUERY;"]},"metadata":{},"sourceType":"module"}